syntax = "proto3";

option java_multiple_files = true;
option java_package = "de.tum.i13.bandency";
option java_outer_classname = "ChallengerProto";

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

package Challenger;

message Payload {
  int32 randomData = 1;
  google.protobuf.Timestamp timestamp = 2;

  float latitude = 3;
  float longitude = 4;

  float p1 = 5;
  float p2 = 6;
}

message Batch {
  int64 seq_id = 1;
  repeated Payload current = 2;
  repeated Payload lastyear = 3;
}

message Benchmark {
  int64 id = 1;
}

message ResultPayload {
  int32 resultData = 1;
  //TODO add here the actual fields
}

message Result {
  int64 benchmark_id = 1;
  int64 payload_seq_id = 2;
  ResultPayload result = 3;
}

message Ping {
  int64 benchmark_id = 1;
  int64 correlation_id = 2;
}

message BenchmarkConfiguration {
  string token = 1; //Token from the webapp for authentication
  int32 batch_size = 2; //Small batches might need different algorithms than large batches
  string benchmark_name = 3; //chosen by the team, listed in the results
}

message Point {
  double longitude = 1;
  double latitude = 2;
}

message Location {
  string zipcode = 1;
  string city = 2;
  double qkm = 3;
  int32 population = 4;
  repeated Point polygon = 5;
}

message Locations{
  repeated Location locations = 1;
}

service Challenger {
  rpc getLocations(google.protobuf.Empty) returns (Locations);

  rpc createNewBenchmark(BenchmarkConfiguration) returns (Benchmark);

  rpc initializeLatencyMeasuring(Benchmark) returns (Ping);
  rpc measure(Ping) returns (Ping);
  rpc endMeasurement(Ping) returns (google.protobuf.Empty);

  rpc startBenchmark(Benchmark) returns(google.protobuf.Empty);

  rpc nextMessage(Benchmark) returns (Batch);
  rpc processed(Result) returns(google.protobuf.Empty);

  rpc endBenchmark(Benchmark) returns(google.protobuf.Empty);
}
